<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Monitoring Ketinggian Sungai Belik</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <script type="module">
      // Import Firebase SDK
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

      // Konfigurasi Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyB7rNwfUKcAXbyXcCtjLLmDrrto4-3mJjM",
        authDomain: "ketinggian-air-sungai-belik.firebaseapp.com",
        databaseURL: "https://ketinggian-air-sungai-belik-default-rtdb.firebaseio.com/",
        projectId: "ketinggian-air-sungai-belik",
        storageBucket: "ketinggian-air-sungai-belik.firebasestorage.app",
        messagingSenderId: "532266336728",
        appId: "1:532266336728:web:a5b12c147a04395ef4b2ad",
        measurementId: "G-4G03RTETYL",
      };

      // Inisialisasi Firebase
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);

      // Inisialisasi Chart.js
      const ctx = document.getElementById("myChart").getContext("2d");
      const myChart = new Chart(ctx, {
        type: "line",
        data: {
          labels: [],
          datasets: [
            {
              label: "Sensor 1",
              data: [],
              borderColor: "rgba(132, 99, 255, 1)",
              borderWidth: 2,
              fill: false,
            }
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              title: {
                display: true,
                text: "Ketinggian (cm)",
              },
              beginAtZero: false,
              min: 0,
              max: 200,
            },
          },
        },
      });

      // Ambil data dari root -> Sensor1
      function getData() {
        const sensor1Ref = ref(database, "Sensor1");
        onValue(sensor1Ref, (snapshot) => {
          const sensor1Data = snapshot.val();

          // Tampilkan di UI (dibulatkan 2 desimal)
          document.querySelector(".tampilan-sensor1 p").innerText = `${sensor1Data.toFixed(2)} cm`;

          // Tambahkan waktu & data ke grafik
          const now = new Date();
          const timeLabel = now.toLocaleTimeString("id-ID", {
            hour: "2-digit",
            minute: "2-digit",
          });

          if (myChart.data.labels.length > 10) {
            myChart.data.labels.shift();
            myChart.data.datasets[0].data.shift();
          }

          myChart.data.labels.push(timeLabel);
          myChart.data.datasets[0].data.push(sensor1Data);
          myChart.update();
        });
      }

      // Jalankan fungsi
      getData();
    </script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background: #f4f4f4;
      }
      .container {
        padding: 20px;
        max-width: 900px;
        margin: auto;
      }
      .title {
        text-align: center;
        margin-bottom: 20px;
      }
      .box {
        background: white;
        padding: 20px;
        border-radius: 10px;
      }
      .box-container {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
      }
      .left-content {
        flex: 1;
        min-width: 250px;
      }
      .status-box h3 {
        margin-top: 0;
      }
      .dot {
        height: 12px;
        width: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 6px;
      }
      .red {
        background-color: red;
      }
      .orange {
        background-color: orange;
      }
      .yellow {
        background-color: yellow;
      }
      .green {
        background-color: green;
      }
      .tampilan-sensor1 {
        margin-top: 20px;
        background: #eee;
        padding: 10px;
        border-radius: 5px;
      }
      .chart-wrapper {
        flex: 2;
        min-height: 300px;
        position: relative;
      }
      canvas {
        width: 100% !important;
        height: 300px !important;
      }
      .himbauan {
        background: #fff3cd;
        padding: 15px;
        margin-top: 20px;
        border-left: 5px solid #ffeeba;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 class="title">
        Monitoring Ketinggian Sungai Belik <br />
        Di Desa Sagan Caturtunggal Depok Sleman Yogyakarta
      </h1>
      <div class="box">
        <div class="info">
          <div class="box-container">
            <div class="left-content">
              <div class="status-box">
                <h3>Status</h3>
                <p><span class="dot red"></span> SIAGA 1: > 170 cm</p>
                <p><span class="dot orange"></span> SIAGA 2: 140 - 170 cm</p>
                <p><span class="dot yellow"></span> SIAGA 3: 100 - 140 cm</p>
                <p><span class="dot green"></span> NORMAL</p>
              </div>
              <div class="tampilan-sensor1">
                <h3>Jl. Kali Belik Sagan</h3>
                <p>-- cm</p>
              </div>
            </div>
            <div class="chart-wrapper">
              <canvas id="myChart"></canvas>
            </div>
          </div>
        </div>
      </div>
      <div class="himbauan">
        <h4>Himbauan!!</h4>
        <p>
          Status saat ini <strong>AMAN</strong>, tidak ada peningkatan debit air
          yang signifikan. Warga dapat beraktivitas seperti biasa, namun tetap
          disarankan untuk memantau ketinggian air secara real-time melalui
          website dan Telegram. Untuk informasi lebih lanjut atau tindakan
          darurat, harap mengikuti arahan resmi dari BPBD setempat.
        </p>
      </div>
    </div>
  </body>
</html>
